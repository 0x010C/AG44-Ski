<!doctype html>

<html lang="fr">
	<head>
		<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
		<!--[if lt IE 9]><script src="js/html5.js"></script><![endif]-->
		<meta charset="UTF-8">
		<title>Ski path finder</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="stylesheet" href="css/style.css" media="all">

		<!-- Inclusion de jQuery et jQuery-ui -->
		<script src="js/jquery-1.10.2.js"></script>
		<script src="js/jquery-ui.js"></script>
		<script src="js/jquery-mousewheel.js"></script>
	</head>
	<body id="body">
	
		<header role="banner">
			<h1>Ski path finder</h1>
		</header>

		<section role="main" id="main">
			<div id="container">
				<img src="img/pistes2.jpg" id="image" usemap="#map" />
				<map name="map">
					<area id="a1" shape="rect" coords="480,71,581,118" href="#" />
				</map>
			</div>
		</section>

		<footer role="contentinfo" id="footer">
			<ul>
				<li><a href="http://0x010c.fr">par Antoine Lamielle</a></li>
				<li><a href="javascript:addStart(Number(prompt('x = ', '')),Number(prompt('y = ', '')));">licence GNU GPL v3</a></li>
				<li><a href="https://github.com/0x010C/AG44-Ski/">fork me on Github</a></li>
			</ul>
		</footer>

		<!-- Initialisation de jQuery-ui draggable -->
		<script>
			var zoom = 1;
			var posMarkerX = [];
			var posMarkerY = [];
			var offsetX = -27/2;
			var offsetY = -40;

		 	function setDrag() {
		 		var left = $("#body").width() - $("#image").width()*zoom;
				var top = $("#body").height() - $("#image").height()*zoom - $("#footer").height();
				var right = 0;
				var bottom = 0;
				$('#image').draggable({ cursor: "move", scroll: false, containment: [left, top, right, bottom], drag: function(){updateMarker();}});
		 	}
			$(window).resize(function() {
				setDrag();
			});
			$(function() {
				setDrag();
			});
		</script>
		<!-- Gestion du zoom -->
		<script>
			function updateZoom() {
				$('#image').css('transform', 'scale('+zoom+')');
				updateMarker();
				if($('#image').position().left > 0)
					$('#image').css('left', '0');
				if($('#image').position().top > 0)
					$('#image').css('top', '0');
				if($('#image').position().left < $("#body").width() - $("#image").width()*zoom)
					$('#image').css('left', ''+($("#body").width() - $("#image").width()*zoom)+'');
				if($('#image').position().top < $("#body").height() - $("#image").height()*zoom - $("#footer").height())
					$('#image').css('top', ''+($("#body").height() - $("#image").height()*zoom - $("#footer").height())+'');
				setDrag();
			}

			$(function() {
				$('#image').mousewheel(function(event, delta) {
					 if (event.deltaY > 0)
                        zoom += 0.1;
                    else if (event.deltaY < 0 && zoom > 1)
                        zoom -= 0.1;
					updateZoom();
				});
			});
		</script>
		<!-- Gestion dynamique des markers -->
		<script>
			function updateMarker() {
				$(".marker").each(function(i) {
					$(this).css('left', posMarkerX[i]*zoom + offsetX + $("#image").position().left);
					$(this).css('top', posMarkerY[i]*zoom + offsetY + $("#image").position().top);
				});
			}
		 	function addMarker(x, y, icon, text) {
		 		$("#container").append('<span style="left: '+y+'px; top: '+x+'px; position: absolute;" title="" class="marker black">'+icon+'</span>');
		 		posMarkerX.push(x);
				posMarkerY.push(y);
		 		updateMarker();
		 	}
		 	function addStart(x, y) {
		 		addMarker(x, y, "D", "Départ");
		 	}
		 	function addEnd(x, y) {
		 		addMarker(x, y, "A", "Arrivée");
		 	}
		 	function addInt(x, y) {
		 		addMarker(x, y, "I", "Intermédiaire");
		 	}
		</script>
	</body>
</html>

