<!doctype html>

<html lang="fr">
<head>
	<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
	<!--[if lt IE 9]><script src="js/html5.js"></script><![endif]-->
	<meta charset="UTF-8">
	<title>Ski path finder</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="css/style.css" media="all">

	<!-- Inclusion de jQuery -->
	<script src="js/jquery-1.10.2.js"></script>
	<script src="js/jquery-ui.js"></script>
	<!-- Inclusion des dÃ©pendances de imgNotes -->
    <script src="js/imgNotes/jquery.fs.zoetrope.min.js"></script>
    <script src="js/imgNotes/toe.min.js"></script>
    <script src="js/imgNotes/jquery.mousewheel.min.js"></script>
    <script src="js/imgNotes/imgViewer.min.js"></script>
    <!-- Inclusion de imgNotes -->
    <script src="js/imgNotes/imgNotes.js"></script>
</head>
<body id="body">
	
	<header role="banner">
		<h1>Ski path finder</h1>
	</header>

	<section role="main" id="main">
		<div id="imgdiv">
			<img src="img/pistes.jpg" id="image" />
		</div>
		<div id=txt></div>
	</section>

	<footer role="contentinfo" id="footer">
		<ul>
			<li><a href="http://0x010c.fr">par Antoine Lamielle</a></li>
			<li><a href="javascript:add()">licence GNU GPL v3</a></li>
			<li><a href="https://github.com/0x010C/AG44-Ski/">fork me on Github</a></li>
		</ul>
	</footer>

	<!-- Activation de imgNotes -->
	<script type="text/javascript">
		;(function($) {
			$(document).ready(function() {
				var $img = $("#image").imgNotes({
					onShow: $.noop,
					onAdd: function() {
								this.options.vAll = "bottom";
								this.options.hAll = "middle";
								var elem = $(document.createElement('span')).addClass("marker black").html(this.noteCount).attr("title", "");
								var self = this;
								$(elem).tooltip({
									content: function() {
										return $(elem).data("note");
									}
							});
							return elem;
					},
					zoomable: false,
					canEdit: false
				});
				$img.imgNotes("import", [{x: "0.3", y:"0.3", note:"AFL Grand Final Trophy"}, {x: "0.824", y: "0.593", note: "Fluffy microphone"}]);
			});
		})(jQuery);
	</script>
	<!-- Initialisation de jQuery-ui draggable -->
	<script>
		var posMarkerX = [];
		var posMarkerY = [];
		function checkMarker() {
			if($("#image").imgNotes("count") > posMarkerX.length)
			{
				$(".marker").each(function(i) {
					if(i >= posMarkerX.length)
					{
						posMarkerX.push($(this).position().left);
						posMarkerY.push($(this).position().top);
					}
				});
			}
		}
		function updateMarker() {
			$(".marker").each(function(i) {
				$(this).css('left', $(".viewport img").position().left + posMarkerX[i]);
				$(this).css('top', $(".viewport img").position().top + posMarkerY[i]);
			});
		}
	 	function setDrag() {
	 		var left = $("#body").width() - $("#image").width();
			var top = $("#body").height() - $("#image").height() - $("#footer").height();
			var right = 0;
			var bottom = 0;
			$( ".viewport img" ).draggable({ cursor: "move", scroll: false, containment: [left, top, right, bottom], start: function(){checkMarker();},drag: function(){updateMarker();}});
	 	}
	 	function add() {
	 		$("#image").imgNotes("addNote", 0.4,0.3,"Note <b>Text</b>");
	 	}
		$(window).resize(function() {
			setDrag();
			$(".marker").css('position', 'relative');
		});
		$(function() {
			setDrag();
			
		});
	</script>
</body>
</html>

